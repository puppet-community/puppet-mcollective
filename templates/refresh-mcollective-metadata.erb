#!/usr/bin/env ruby

require 'facter'
require 'facter/application'

Facter::Application.load_puppet

excluded_facts_re = Regexp.new( "^(<%= @excluded_facts.join("|") %>)$", true)

facts_hash = Facter.to_hash
facts_hash = facts_hash.reject { |k,v|
  k.to_s =~ excluded_facts_re
}
facts = YAML.dump(facts_hash)

File.open('<%= @yaml_fact_path_real -%>.new', 'w') do |f|
  f.puts facts
end

File.rename('<%= @yaml_fact_path_real -%>.new', '<%= @yaml_fact_path_real -%>')
